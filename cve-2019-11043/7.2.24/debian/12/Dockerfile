FROM debian:12
RUN apt-get update -y && apt-get -y upgrade
RUN apt-get install -y git build-essential autoconf bison re2c libxml2-dev zlib1g-dev nginx
RUN git clone https://github.com/php/php-src
RUN cd /php-src && git checkout php-7.2.24
RUN cd /php-src && ./buildconf --force && ./configure --enable-fpm --without-pear && make -j4 && make install
COPY php-fpm.conf /usr/local/etc/php-fpm.conf
COPY nginx.conf /etc/nginx/nginx.conf
COPY script.php /usr/share/nginx/html/script.php
COPY entrypoint /entrypoint
RUN chmod +x /entrypoint
# RUN rm -f /php-src/sapi/fpm/fpm/fpm_main.c
# COPY fpm_main.c /php-src/sapi/fpm/fpm/fpm_main.c
# RUN rm -f /php-src/main/fastcgi.c
# COPY fastcgi.c /php-src/main/fastcgi.c
# RUN cd /php-src && make -j4 && make install
CMD /entrypoint
