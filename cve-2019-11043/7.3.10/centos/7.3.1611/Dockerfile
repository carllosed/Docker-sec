FROM centos:centos7.3.1611
RUN yum update -y && yum upgrade -y
RUN yum groupinstall -y 'Development Tools' && yum install -y epel-release && yum install -y git re2c libxml2-devel zlib nginx which
RUN git clone https://github.com/php/php-src
RUN cd /php-src && git checkout php-7.3.10
RUN cd /php-src && ./buildconf --force && ./configure --enable-fpm --without-pear && make -j4 && make install
COPY php-fpm.conf /usr/local/etc/php-fpm.conf
COPY nginx.conf /etc/nginx/nginx.conf
COPY script.php /usr/share/nginx/html/script.php
COPY entrypoint /entrypoint
RUN chmod +x /entrypoint
RUN useradd -r -U www-data
# RUN rm -f /php-src/sapi/fpm/fpm/fpm_main.c
# COPY fpm_main.c /php-src/sapi/fpm/fpm/fpm_main.c
# RUN rm -f /php-src/main/fastcgi.c
# COPY fastcgi.c /php-src/main/fastcgi.c
# RUN cd /php-src && make -j4 && make install
CMD /entrypoint
